%% Data setup
load 

% ************************************************************************
% object = 'car';
% dataset = 'PASCAL2007';
% featureFolder = '../borrow_semisup/';   % folder for the feature file
% datasetMetaFolder = '../borrow_semisup/'; % folder for the dataset meta-data file
% addpath('libsvm-3.12/matlab/');
% addpath('../borrow_semisup/liblinear-1.8/matlab/');
% datasetMetaFile = fullfile(datasetMetaFolder, [dataset, '_meta.mat']);
% % featureFile = fullfile(featureFolder, [dataset, '_llc_2f_' object '.mat']);
% featureFile = 'toy_pascal.mat';
% 
% load(featureFile);
% 
% train_features = [train_features, ones(size(train_features,1),1)];
% test_features = [test_features, ones(size(test_features,1),1)];
% 
% train_labels = train_labels';

%% Parameter setup
C_p = [1000];   % Insert more values for parameter tuning
C_b = [1];
C_svdd = [1 10 100 1000];

cnt = 0;
for i = 1 : numel(C_p)
    for j = 1 : numel(C_b)
        for k = 1 : numel(C_svdd)
            cnt = cnt + 1;
            opts{cnt}.C_p = C_p(i);
            opts{cnt}.C_b = C_b(j);
            opts{cnt}.C_svdd = C_svdd(k);
        end
    end
end

org_w = cell(cnt,1);
ball_w = cell(cnt,1);
for i = 1 : cnt
    ball_w{i} = ball_svm(train_labels, train_features, opts{cnt});
    model = train(double(train_labels), sparse(train_features), ['-s 0 -c ' num2str(opts{i}.C_p) ' -q 1']);
    org_w{i} = model.w';
    org_dec_val{i} = test_features * org_w{i};
    org_ap(i) = myAP(org_dec_val{i}, test_labels',1);
end